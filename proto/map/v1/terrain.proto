syntax = "proto3";

package map.v1;

import "creature/v1/creature.proto";
import "magic/v1/spell.proto";

option go_package = "github.com/openhexes/proto;mapv1";

message Terrain {
  enum MovementType {
    MOVEMENT_TYPE_UNSPECIFIED = 0;
    MOVEMENT_TYPE_WALKING = 1;
    MOVEMENT_TYPE_SWIMMING = 2;
    MOVEMENT_TYPE_FLYING = 3;
    MOVEMENT_TYPE_PORTALING = 4;
  }

  enum RenderingType {
    RENDERING_TYPE_UNSPECIFIED = 0;
    RENDERING_TYPE_ABYSS = 1;
    RENDERING_TYPE_WATER = 2;
    RENDERING_TYPE_GRASS = 3;
    RENDERING_TYPE_HIGHLANDS = 4;
    RENDERING_TYPE_DIRT = 5;
    RENDERING_TYPE_ASH = 6;
    RENDERING_TYPE_SUBTERRANEAN = 7;
    RENDERING_TYPE_ROUGH = 8;
    RENDERING_TYPE_WASTELAND = 9;
    RENDERING_TYPE_SAND = 10;
    RENDERING_TYPE_SNOW = 11;
    RENDERING_TYPE_SWAMP = 12;
  }

  message Effect {
    message ModifySpellLevel {
      magic.v1.Spell.Filter filter = 1;
      int32 delta = 2;
    }

    message PreventSpellCasting {
      magic.v1.Spell.Filter filter = 1;
      optional int32 level_gte = 2;
      optional int32 level_lte = 3;
    }

    message DisableNativeTerrainBonuses {}

    message ModifyCreatureMovementType {
      creature.v1.Creature.Kind.Filter filter = 1;
      repeated creature.v1.Creature.MovementType remove = 2;
      repeated creature.v1.Creature.MovementType add = 3;
    }

    message ModifyCreatureMorale {
      creature.v1.Creature.Kind.Filter filter = 1;
      creature.v1.Creature.AttributeModification modification = 2;
    }

    message ModifyCreatureLuck {
      creature.v1.Creature.Kind.Filter filter = 1;
      creature.v1.Creature.AttributeModification modification = 2;
    }

    message ModifyCreatureAttack {
      creature.v1.Creature.Kind.Filter filter = 1;
      creature.v1.Creature.AttributeModification modification = 2;
    }

    message ModifyCreatureDefence {
      creature.v1.Creature.Kind.Filter filter = 1;
      creature.v1.Creature.AttributeModification modification = 2;
    }

    message ModifyCreatureSpeed {
      creature.v1.Creature.Kind.Filter filter = 1;
      creature.v1.Creature.AttributeModification modification = 2;
    }

    oneof kind {
      map.v1.Terrain.Effect.ModifySpellLevel modify_spell_level = 1;
      map.v1.Terrain.Effect.PreventSpellCasting prevent_spell_casting = 2;
      map.v1.Terrain.Effect.DisableNativeTerrainBonuses disable_native_terrain_bonuses = 3;
      map.v1.Terrain.Effect.ModifyCreatureMovementType modify_creature_movement_type = 4;
      map.v1.Terrain.Effect.ModifyCreatureMorale modify_creature_morale = 5;
      map.v1.Terrain.Effect.ModifyCreatureLuck modify_creature_luck = 6;
      map.v1.Terrain.Effect.ModifyCreatureAttack modify_creature_attack = 7;
      map.v1.Terrain.Effect.ModifyCreatureDefence modify_creature_defence = 8;
      map.v1.Terrain.Effect.ModifyCreatureSpeed modify_creature_speed = 9;
    }
  }

  message RenderingSpec {
    map.v1.Terrain.RenderingType rendering_type = 1;
  }

  string id = 1;
  map<string, bool> tags = 2;

  uint32 movement_penalty = 3;
  repeated map.v1.Terrain.MovementType can_pass_with = 4;
  repeated map.v1.Terrain.MovementType can_stop_with = 5;

  repeated map.v1.Terrain.Effect effects = 6;
  map.v1.Terrain.RenderingSpec rendering_spec = 7;
}
