syntax = "proto3";

package map.v1;

import "map/v1/compass.proto";

option go_package = "github.com/openhexes/proto;mapv1";

message Tile {
  message Coordinate {
    uint32 row = 1;
    uint32 column = 2;
    uint32 depth = 3;
  }

  message Edge {
    map.v1.EdgeDirection direction = 1;
    string neighbour_terrain_id = 2;
  }

  message Corner {
    map.v1.CornerDirection direction = 1;
    map<int32, map.v1.Tile.Edge> edges = 2;
  }

  message RenderingSpec {
    map<int32, map.v1.Tile.Edge> edges = 1;
    map<int32, map.v1.Tile.Corner> corners = 2;
    repeated string feature_ids = 3; // landscape features, e.g. trees, rocks, etc.
  }

  string key = 1;
  map.v1.Tile.Coordinate coordinate = 2;
  string terrain_id = 3;
  map.v1.Tile.RenderingSpec rendering_spec = 4;
}

message Segment {
  message Bounds {
    uint32 depth = 1;
    int32 min_row = 2;
    int32 max_row = 3;
    int32 min_column = 4;
    int32 max_column = 5;
  }

  message RenderingSpec {
    string svg = 1;
    string svg_lightweight = 2; // Simplified SVG for fullscreen view without edges, corners, and patterns
    bytes webp = 3; // Rasterized WebP image data for performance
    bytes webp_lightweight = 4; // Simplified WebP for fullscreen view
  }

  message Row {
    repeated map.v1.Segment segments = 1;
  }

  string key = 1;
  map.v1.Segment.Bounds bounds = 2;
  repeated map.v1.Tile tiles = 3;
  map.v1.Segment.RenderingSpec rendering_spec = 4;
}

message Layer {
  string name = 1;
  uint32 depth = 2;
  uint32 total_rows = 3;
  uint32 total_columns = 4;
  repeated map.v1.Segment.Row segment_rows = 5;
}
