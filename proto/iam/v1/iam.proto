syntax = "proto3";

package iam.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/openhexes/proto;iamv1";

message Account {
  message Meta {
    bool active = 1;
    google.protobuf.Timestamp created_at = 2;
    string display_name = 3;
    string picture = 4;
  }

  string id = 1;
  iam.v1.Account.Meta meta = 2;
  string email = 3;
  repeated string roles = 4;
}

message ResolveAccountRequest {}

message ResolveAccountResponse {
  iam.v1.Account account = 1;
}

message ListAccountsRequest {
  optional bool active = 1;
}

message ListAccountsResponse {
  repeated iam.v1.Account accounts = 1;
}

message GetAccountRequest {
  string id = 1;
  bool with_roles = 2;
}

message GetAccountResponse {
  iam.v1.Account account = 1;
}

message UpdateAccountActivationRequest {
  map<string, bool> id_to_activation = 1;
}

message UpdateAccountActivationResponse {}

service IAMService {
  rpc ResolveAccount(ResolveAccountRequest) returns (ResolveAccountResponse);
  rpc ListAccounts(ListAccountsRequest) returns (stream ListAccountsResponse);
  rpc GetAccount(GetAccountRequest) returns (GetAccountResponse);
  rpc UpdateAccountActivation(UpdateAccountActivationRequest) returns (UpdateAccountActivationResponse);
}
